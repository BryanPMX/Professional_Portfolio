---
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';

const projects = [
  {
    title: "CAF Case Management System",
    description: "Authorized demonstration of a comprehensive case management platform developed for Centro De Apoyo A.C. Features secure case intake, scheduling, analytics, and administrative tools. Built with clean architecture principles using Go (Gin, GORM) and PostgreSQL, with production-grade admin portal using Next.js 14 and TypeScript. Includes JWT Role-Based Access Control and authenticated WebSockets for real-time case updates.",
    image: "/assets/project-3.png",
    technologies: ["Go", "Next.js", "PostgreSQL", "TypeScript", "WebSockets"],
    liveUrl: "#" // Video demo link will be provided
  },
  {
    title: "DEM Bravo (Docker Exploit Mapper)",
    description: "Architected an offline-first cybersecurity platform using FastAPI and Neo4j to model complex container attack graphs, implementing asynchronous Docker SDK orchestration to stream live scan results. Developed a reactive visualization dashboard with SvelteKit and Cytoscape to render real-time network topologies, enabling interactive visual analysis of vulnerability paths. Enforced STIG-compliant database security by building a custom query sanitizer for Cypher, preventing injection attacks while managing multi-tool data ingestion.",
    image: "/assets/project-1.png",
    technologies: ["FastAPI", "Neo4j", "SvelteKit", "Docker", "Python"],
    githubUrl: "https://github.com/ChristianDees/CS4311_DEM_Bravo_Fall2025",
    liveUrl: "#" // Will be provided later
  },
  {
    title: "Bank of Miners",
    description: "Refactored a legacy CLI tool into a web app, optimizing data retrieval with a custom Binary Search Tree (BST) for O(log n) efficiency and Write-Through persistence. Engineered a secure banking core using Java OOP and Strategy Design Patterns to enforce polymorphic account behaviors and dynamic credit limits. Containerized the application using Docker and Nginx while establishing a GitHub Actions CI/CD pipeline to automate JUnit testing and builds.",
    image: "/assets/project-2.jpeg",
    technologies: ["Java", "Spring Boot", "React", "Docker"],
    githubUrl: "https://github.com/BryanPMX/bank-system",
    liveUrl: "#" // Will be provided later
  },
  {
    title: "Zombie Survival Roguelite",
    description: "Developed a top-down survival game featuring persistent meta-progression and a collision-aware wave orchestration system using NavigationServer2D. Architected modular behaviors using Finite State Machines (FSM) for entity logic and a global SignalBus pattern to decouple UI and game state.",
    image: "/assets/project-4.png",
    technologies: ["Godot 4.5", "GDScript", "JSON"],
    githubUrl: "https://github.com/construction-team7/zombie-game",
    liveUrl: "#" // Will be provided later
  }
];
---

<Layout title="Projects - Bryan Perez">
  <div class="min-h-screen">
    <!-- Header Section -->
    <section class="py-20 px-6">
      <div class="max-w-6xl mx-auto text-center">
        <h1 class="text-4xl lg:text-5xl font-bold mb-6 bg-gradient-to-r from-dark-text to-dark-text-secondary bg-clip-text text-transparent">
          My Projects
        </h1>
        <p class="text-xl text-dark-text-secondary max-w-3xl mx-auto mb-8">
          A showcase of software solutions including personal projects and authorized work demonstrations.
          Each project highlights different technologies, architectures, and problem-solving approaches.
        </p>
        <div class="flex flex-wrap justify-center gap-4 mb-12">
          <span class="px-4 py-2 bg-accent/20 text-accent rounded-full font-medium">Case Management</span>
          <span class="px-4 py-2 bg-accent-purple/20 text-accent-purple rounded-full font-medium">Cybersecurity</span>
          <span class="px-4 py-2 bg-dark-surface text-dark-text rounded-full font-medium">Game Development</span>
          <span class="px-4 py-2 bg-accent/20 text-accent rounded-full font-medium">Full-Stack Solutions</span>
        </div>
      </div>
    </section>

    <!-- Projects Carousel -->
    <section class="pb-20 px-6">
      <div class="max-w-6xl mx-auto">
        <div class="relative">
          <!-- Carousel Container -->
          <div class="overflow-hidden">
            <div
              id="projects-carousel"
              class="flex transition-transform duration-500 ease-in-out gap-8"
              style="transform: translateX(0%);"
            >
              {projects.map((project, index) => (
                <div class="flex-shrink-0 w-full md:w-1/2 lg:w-1/2 xl:w-1/4">
                  <ProjectCard
                    title={project.title}
                    description={project.description}
                    image={project.image}
                    technologies={project.technologies}
                    githubUrl={project.githubUrl}
                    liveUrl={project.liveUrl}
                    type="project"
                  />
                </div>
              ))}
            </div>
          </div>

          <!-- Navigation Arrows -->
          <button
            id="prev-btn"
            class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-dark-card hover:bg-dark-bg text-dark-text p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>

          <button
            id="next-btn"
            class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-dark-card hover:bg-dark-bg text-dark-text p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>

          <!-- Dots Indicator -->
          <div class="flex justify-center mt-8 space-x-2">
            <div id="dots-container" class="flex space-x-2">
              <!-- Dots will be generated by JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="py-20 px-6 bg-dark-surface">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl lg:text-4xl font-bold mb-6">Interested in Working Together?</h2>
        <p class="text-xl text-dark-text-secondary mb-8 max-w-2xl mx-auto">
          I'm always excited to collaborate on interesting projects and explore new opportunities.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/contact" 
            class="bg-accent hover:bg-accent-hover text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105"
          >
            Get In Touch
          </a>
          <a 
            href="/assets/Bryan Resume 2025.pdf" 
            target="_blank"
            class="border border-accent text-accent hover:bg-accent hover:text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105"
          >
            View Resume
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<!-- Modal for Live Demos -->
<div id="modal-container"></div>

<script>
  import Modal from '../components/Modal.tsx';
  import { createRoot } from 'react-dom/client';
  import React from 'react';

  // Modal state management
  let modalRoot: any = null;

  function openModal(url: string, title: string) {
    const container = document.getElementById('modal-container');
    if (!container) return;

    if (!modalRoot) {
      modalRoot = createRoot(container);
    }

    const closeModal = () => {
      modalRoot.render(React.createElement('div'));
    };

    modalRoot.render(
      React.createElement(Modal, {
        isOpen: true,
        onClose: closeModal,
        title: title,
        url: url
      })
    );
  }

  // Projects Carousel Functionality
  class ProjectsCarousel {
    constructor() {
      this.carousel = document.getElementById('projects-carousel');
      this.prevBtn = document.getElementById('prev-btn');
      this.nextBtn = document.getElementById('next-btn');
      this.dotsContainer = document.getElementById('dots-container');
      this.currentSlide = 0;
      this.slidesToShow = this.getSlidesToShow();
      this.totalSlides = 4; // We have 4 projects

      this.init();
    }

    getSlidesToShow() {
      if (window.innerWidth >= 1280) return 4; // xl: 4 slides
      if (window.innerWidth >= 1024) return 2; // lg: 2 slides
      if (window.innerWidth >= 768) return 2;  // md: 2 slides
      return 1; // mobile: 1 slide
    }

    init() {
      this.createDots();
      this.updateButtons();
      this.addEventListeners();
      this.updateCarousel();
      window.addEventListener('resize', () => this.handleResize());
    }

    createDots() {
      const totalDots = Math.ceil(this.totalSlides / this.slidesToShow);
      this.dotsContainer.innerHTML = '';

      for (let i = 0; i < totalDots; i++) {
        const dot = document.createElement('button');
        dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
          i === this.currentSlide ? 'bg-accent' : 'bg-dark-surface'
        }`;
        dot.addEventListener('click', () => this.goToSlide(i));
        this.dotsContainer.appendChild(dot);
      }
    }

    updateButtons() {
      const totalDots = Math.ceil(this.totalSlides / this.slidesToShow);
      this.prevBtn.disabled = this.currentSlide === 0;
      this.nextBtn.disabled = this.currentSlide === totalDots - 1;
    }

    addEventListeners() {
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());
    }

    prevSlide() {
      if (this.currentSlide > 0) {
        this.currentSlide--;
        this.updateCarousel();
      }
    }

    nextSlide() {
      const totalDots = Math.ceil(this.totalSlides / this.slidesToShow);
      if (this.currentSlide < totalDots - 1) {
        this.currentSlide++;
        this.updateCarousel();
      }
    }

    goToSlide(slideIndex) {
      this.currentSlide = slideIndex;
      this.updateCarousel();
    }

    updateCarousel() {
      const translateX = -this.currentSlide * (100 / this.slidesToShow);
      this.carousel.style.transform = `translateX(${translateX}%)`;

      // Update dots
      const dots = this.dotsContainer.querySelectorAll('button');
      dots.forEach((dot, index) => {
        dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
          index === this.currentSlide ? 'bg-accent' : 'bg-dark-surface'
        }`;
      });

      this.updateButtons();
    }

    handleResize() {
      const newSlidesToShow = this.getSlidesToShow();
      if (newSlidesToShow !== this.slidesToShow) {
        this.slidesToShow = newSlidesToShow;
        this.currentSlide = 0;
        this.createDots();
        this.updateCarousel();
      }
    }
  }

  // Initialize everything when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize carousel
    new ProjectsCarousel();

    // Add event listeners to live demo buttons
    const liveDemoButtons = document.querySelectorAll('.live-demo-btn');

    liveDemoButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        const url = (e.target as HTMLButtonElement).dataset.url;
        const title = (e.target as HTMLButtonElement).dataset.title;

        if (url && title) {
          openModal(url, title);
        }
      });
    });
  });
</script>
