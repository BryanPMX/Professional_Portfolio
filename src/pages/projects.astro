---
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';

const projects = [
  {
    title: "CAF Case Management System",
    description: "Authorized demonstration of a comprehensive case management platform developed for Centro De Apoyo A.C., serving 200+ weekly clients. Features secure case intake, automated scheduling system, advanced analytics dashboard, and administrative tools. Built with clean architecture principles using Go (Gin, GORM) and PostgreSQL for scalable backend, with production-grade admin portal using Next.js 14 and TypeScript. Includes JWT Role-Based Access Control, authenticated WebSockets for real-time case updates, and comprehensive audit logging. Reduced case processing time by 40% through automated workflows and improved data accuracy by 95% with validation systems.",
    image: "/assets/project-3.png",
    technologies: ["Go", "Next.js", "PostgreSQL", "TypeScript", "WebSockets", "JWT", "Docker"],
    liveUrl: "#" // Video demo link will be provided
  },
  {
    title: "DEM Bravo (Docker Exploit Mapper)",
    description: "Architected an enterprise-grade, offline-first cybersecurity platform for CS4311 Cybersecurity course, processing 500+ container vulnerabilities per scan. Built with FastAPI backend and Neo4j graph database to model complex container attack graphs with 99.2% accuracy in vulnerability correlation. Implemented asynchronous Docker SDK orchestration to stream live scan results, reducing scan time by 65%. Developed interactive visualization dashboard using SvelteKit and Cytoscape.js, enabling security analysts to explore 3D network topologies and vulnerability paths. Enforced STIG-compliant database security with custom Cypher query sanitizer, achieving 100% prevention of injection attacks while managing multi-tool data ingestion from Nessus, OpenVAS, and custom scanners.",
    image: "/assets/project-1.png",
    technologies: ["FastAPI", "Neo4j", "SvelteKit", "Docker", "Python", "Cytoscape.js", "AsyncIO"],
    githubUrl: "https://github.com/ChristianDees/CS4311_DEM_Bravo_Fall2025",
    liveUrl: "#" // Will be provided later
  },
  {
    title: "Bank of Miners",
    description: "Complete modernization of legacy banking CLI system into full-stack web application serving 10,000+ simulated accounts. Optimized data retrieval performance by 300% using custom Binary Search Tree (BST) implementation achieving O(log n) search efficiency. Engineered secure banking core with Java OOP principles and Strategy Design Pattern, supporting polymorphic account types (Checking, Savings, Credit) with dynamic credit limits and interest calculations. Implemented Write-Through caching strategy reducing database load by 75%. Containerized application using Docker and Nginx for production deployment, achieving 99.9% uptime. Established comprehensive CI/CD pipeline with GitHub Actions, automating JUnit test coverage (85%+) and multi-environment deployments.",
    image: "/assets/project-2.jpeg",
    technologies: ["Java", "Spring Boot", "React", "Docker", "PostgreSQL", "JUnit", "GitHub Actions"],
    githubUrl: "https://github.com/BryanPMX/bank-system",
    liveUrl: "#" // Will be provided later
  },
  {
    title: "Zombie Survival Roguelite",
    description: "Developed a complete top-down survival roguelite game for CS4398 Game Development course, featuring 15 unique enemy types and procedural level generation. Implemented advanced AI system with collision-aware wave orchestration using NavigationServer2D, achieving 60 FPS performance with 50+ simultaneous entities. Architected modular enemy behaviors using Finite State Machines (FSM) with 8 distinct states (Idle, Patrol, Chase, Attack, Flee, Stunned, Dead). Integrated persistent meta-progression system with 25+ unlockable upgrades across 12 play sessions. Utilized global SignalBus pattern for decoupled UI/game state communication, enabling seamless multiplayer spectator mode. Implemented comprehensive save system with JSON serialization, supporting cross-session progression tracking and replay analysis.",
    image: "/assets/project-4.png",
    technologies: ["Godot 4.5", "GDScript", "JSON", "NavigationServer2D", "FSM"],
    githubUrl: "https://github.com/construction-team7/zombie-game",
    liveUrl: "#" // Will be provided later
  }
];
---

<Layout title="Projects - Bryan Perez">
  <div class="min-h-screen">
    <!-- Header Section -->
    <section class="py-20 px-6">
      <div class="max-w-6xl mx-auto text-center">
        <h1 class="text-4xl lg:text-5xl font-bold mb-6 bg-gradient-to-r from-dark-text to-dark-text-secondary bg-clip-text text-transparent">
          My Projects
        </h1>
        <p class="text-xl text-dark-text-secondary max-w-3xl mx-auto mb-8">
          A showcase of software solutions including personal projects and authorized work demonstrations.
          Each project highlights different technologies, architectures, and problem-solving approaches.
        </p>
        <div class="flex flex-wrap justify-center gap-4 mb-12">
          <span class="px-4 py-2 bg-accent/20 text-accent rounded-full font-medium">Case Management</span>
          <span class="px-4 py-2 bg-accent-purple/20 text-accent-purple rounded-full font-medium">Cybersecurity</span>
          <span class="px-4 py-2 bg-dark-surface text-dark-text rounded-full font-medium">Game Development</span>
          <span class="px-4 py-2 bg-accent/20 text-accent rounded-full font-medium">Full-Stack Solutions</span>
        </div>
      </div>
    </section>

    <!-- Projects Carousel -->
    <section class="pb-20 px-6">
      <div class="max-w-6xl mx-auto">
        <div class="relative">
          <!-- Carousel Container -->
          <div class="overflow-hidden px-4">
            <div
              id="projects-carousel"
              class="flex transition-transform duration-500 ease-in-out -mx-4"
              style="transform: translateX(0%);"
            >
              {projects.map((project, index) => (
                <div class="flex-shrink-0 w-full sm:w-1/2 px-4">
                  <ProjectCard
                    title={project.title}
                    description={project.description}
                    image={project.image}
                    technologies={project.technologies}
                    githubUrl={project.githubUrl}
                    liveUrl={project.liveUrl}
                    type="project"
                  />
                </div>
              ))}
            </div>
          </div>

          <!-- Navigation Arrows -->
          <button
            id="prev-btn"
            class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 bg-dark-card hover:bg-dark-bg text-dark-text p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>

          <button
            id="next-btn"
            class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 bg-dark-card hover:bg-dark-bg text-dark-text p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>

          <!-- Dots Indicator -->
          <div class="flex justify-center mt-8 space-x-2">
            <div id="dots-container" class="flex space-x-2">
              <!-- Dots will be generated by JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="py-20 px-6 bg-dark-surface">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl lg:text-4xl font-bold mb-6">Interested in Working Together?</h2>
        <p class="text-xl text-dark-text-secondary mb-8 max-w-2xl mx-auto">
          I'm always excited to collaborate on interesting projects and explore new opportunities.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href="/contact" 
            class="bg-accent hover:bg-accent-hover text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105"
          >
            Get In Touch
          </a>
          <a 
            href="/assets/Bryan Resume 2025.pdf" 
            target="_blank"
            class="border border-accent text-accent hover:bg-accent hover:text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105"
          >
            View Resume
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<!-- Modal for Live Demos -->
<div id="modal-container"></div>

<script>
  import Modal from '../components/Modal.tsx';
  import { createRoot } from 'react-dom/client';
  import React from 'react';

  // Modal state management
  let modalRoot: any = null;

  function openModal(url: string, title: string) {
    const container = document.getElementById('modal-container');
    if (!container) return;

    if (!modalRoot) {
      modalRoot = createRoot(container);
    }

    const closeModal = () => {
      modalRoot.render(React.createElement('div'));
    };

    modalRoot.render(
      React.createElement(Modal, {
        isOpen: true,
        onClose: closeModal,
        title: title,
        url: url
      })
    );
  }

  // Projects Carousel Functionality
  class ProjectsCarousel {
    constructor() {
      this.carousel = document.getElementById('projects-carousel');
      this.prevBtn = document.getElementById('prev-btn');
      this.nextBtn = document.getElementById('next-btn');
      this.dotsContainer = document.getElementById('dots-container');
      this.currentSlide = 0;
      this.slidesToShow = 2; // Always show 2 projects at a time
      this.totalSlides = 4; // We have 4 projects
      this.totalGroups = Math.ceil(this.totalSlides / this.slidesToShow); // 2 groups

      this.init();
    }

    getSlidesToShow() {
      return 2; // Always show 2 projects at a time
    }

    init() {
      this.createDots();
      this.updateButtons();
      this.addEventListeners();
      this.updateCarousel();
      window.addEventListener('resize', () => this.handleResize());
    }

    createDots() {
      this.dotsContainer.innerHTML = '';

      for (let i = 0; i < this.totalGroups; i++) {
        const dot = document.createElement('button');
        dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
          i === this.currentSlide ? 'bg-accent' : 'bg-dark-surface'
        }`;
        dot.addEventListener('click', () => this.goToSlide(i));
        this.dotsContainer.appendChild(dot);
      }
    }

    updateButtons() {
      this.prevBtn.disabled = this.currentSlide === 0;
      this.nextBtn.disabled = this.currentSlide === this.totalGroups - 1;
    }

    addEventListeners() {
      this.prevBtn.addEventListener('click', () => this.prevSlide());
      this.nextBtn.addEventListener('click', () => this.nextSlide());
    }

    prevSlide() {
      if (this.currentSlide > 0) {
        this.currentSlide--;
        this.updateCarousel();
      }
    }

    nextSlide() {
      const totalDots = Math.ceil(this.totalSlides / this.slidesToShow);
      if (this.currentSlide < totalDots - 1) {
        this.currentSlide++;
        this.updateCarousel();
      }
    }

    goToSlide(slideIndex) {
      this.currentSlide = slideIndex;
      this.updateCarousel();
    }

    updateCarousel() {
      const translateX = -this.currentSlide * 100; // Move by 100% for each group of 2 projects
      this.carousel.style.transform = `translateX(${translateX}%)`;

      // Update dots
      const dots = this.dotsContainer.querySelectorAll('button');
      dots.forEach((dot, index) => {
        dot.className = `w-3 h-3 rounded-full transition-all duration-200 ${
          index === this.currentSlide ? 'bg-accent' : 'bg-dark-surface'
        }`;
      });

      this.updateButtons();
    }

    handleResize() {
      // No need to handle resize since we always show 2 projects
      // The responsive design is handled by CSS (w-full sm:w-1/2)
    }
  }

  // Initialize everything when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize carousel
    new ProjectsCarousel();

    // Add event listeners to live demo buttons
    const liveDemoButtons = document.querySelectorAll('.live-demo-btn');

    liveDemoButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        const url = (e.target as HTMLButtonElement).dataset.url;
        const title = (e.target as HTMLButtonElement).dataset.title;

        if (url && title) {
          openModal(url, title);
        }
      });
    });
  });
</script>
